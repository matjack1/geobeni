jQuery(function(a){a(".geo-mashup-search-find-me").show().click(function(){var b=a(this),j=b.parent("form"),d=j.find("input.geo-mashup-search-input"),c=j.find("input[name=geolocation]"),e=j.find("input[name=geo_mashup_search_submit]"),i,h=function(m,k){var l="http://www.geoplugin.net/extras/location.gp?jsoncallback=?&format=json&lat="+encodeURIComponent(m)+"&long="+encodeURIComponent(k);clearTimeout(i);b.hide();c.val(m+","+k);a.getJSON(l,function(n){if(n.geoplugin_place&&n.geoplugin_region){d.val(n.geoplugin_place+", "+n.geoplugin_region)}else{d.val(geo_mashup_search_find_me_env.my_location_message)}}).error(function(){d.val(geo_mashup_search_find_me_env.my_location_message)});e.focus()},g=function(){clearTimeout(i);b.hide();d.val(geo_mashup_search_find_me_env.fail_message)},f=function(){var k;clearTimeout(i);if(!geo_mashup_search_find_me_env.client_ip){g()}k="http://www.geoplugin.net/json.gp?jsoncallback=?&ip="+geo_mashup_search_find_me_env.client_ip;a.getJSON(k,function(l){if(l.geoplugin_latitude&&l.geoplugin_longitude){h(l.geoplugin_latitude,l.geoplugin_longitude)}else{g()}}).error(g)};b.prop("disabled",true);d.change(function(){c.val("")});if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(k){h(k.coords.latitude,k.coords.longitude)},function(k){f()},{timeout:4000});i=setTimeout(f,10000)}return false})});