GeoMashup.loadFullPost=function(a){var c,e,b,f,d;f=this.getObjectsAtLocation(a);d=this.getOnObjectIDs(f);b=this.locationCache(a,"full-post-"+d.join(","));if(b.html){this.getShowPostElement().innerHTML=b.html}else{this.getShowPostElement().innerHTML='<div align="center"><img src="'+this.opts.url_path+'/images/busy_icon.gif" alt="Loading..." /></div>';e={url:this.geo_query_url+"&object_name="+this.opts.object_name+"&object_ids="+d.join(",")+"&template=full-post"};this.doAction("fullPostRequest",f,e);jQuery.get(e.url,function(h){var g={content:h};GeoMashup.doAction("fullPostLoad",f,g);b.html=g.content;jQuery(GeoMashup.getShowPostElement()).html(g.content);GeoMashup.doAction("fullPostChanged")})}};GeoMashup.createTermLine=function(a,d,c){var b={color:c.color,width:5,opacity:0.5,visible:true,taxonomy:a,term_id:d};c.line=new mxn.Polyline(c.points);this.doAction("termLine",c.line,a,d,c);this.doAction("categoryLine",this.opts,c.line);this.doAction("termLineOptions",b,a,d,c);this.doAction("categoryLineOptions",this.opts,b);this.map.addPolylineWithData(c.line,b);if(this.map.getZoom()>c.max_line_zoom){this.hideLine(c.line)}};GeoMashup.openInfoWindow=function(b){var g,c,e,d,f,a=b.location;if(this.open_window_marker&&!this.opts.multiple_info_windows){this.open_window_marker.closeBubble()}e=this.getOnObjectIDs(this.getObjectsAtLocation(a));c=this.locationCache(a,"info-window-"+e.join(","));if(c.html){b.setInfoBubble(c.html);b.openBubble()}else{b.setInfoBubble('<div align="center"><img src="'+this.opts.url_path+'/images/busy_icon.gif" alt="Loading..." /></div>');b.openBubble();this.open_window_marker=b;g={url:this.geo_query_url+"&object_name="+this.opts.object_name+"&object_ids="+e.join(",")};this.doAction("markerInfoWindowRequest",b,g);jQuery.get(g.url,function(i){var h={content:i};b.closeBubble();GeoMashup.doAction("markerInfoWindowLoad",b,h);c.html=GeoMashup.parentizeLinksMarkup(h.content);b.setInfoBubble(c.html);b.openBubble()})}};GeoMashup.closeInfoWindow=function(a){a.closeBubble()};GeoMashup.addGlowMarker=function(b){var a=b.location,c={clickable:true,icon:this.opts.url_path+"/images/mm_20_glow.png",iconSize:[22,30],iconAnchor:[11,27]};if(this.glow_marker){this.removeGlowMarker()}this.doAction("glowMarkerIcon",this.opts,c);this.glow_marker=new mxn.Marker(a);this.glow_marker.addData(c);this.glow_marker.click.addHandler(function(){GeoMashup.deselectMarker()});this.map.addMarker(this.glow_marker)};GeoMashup.removeGlowMarker=function(){if(this.glow_marker){this.glow_marker.hide();this.map.removeMarker(this.glow_marker);this.glow_marker=null}};GeoMashup.hideAttachments=function(){var b,a,c};GeoMashup.showMarkerAttachments=function(a){var b,c=[];this.hideAttachments();b=this.getOnObjectIDs(this.getMarkerObjects(a));jQuery.each(b,function(d,f){var e=GeoMashup.locationCache(a.location,"attachments-"+f);if(e.urls){jQuery.each(e.urls,function(h,g){GeoMashup.open_attachments.push(g);GeoMashup.map.addOverlay(g)})}else{c.push(f)}});jQuery.each(c,function(e,f){var d={action:"geo_mashup_kml_attachments"};d.post_ids=f;jQuery.getJSON(GeoMashup.opts.ajaxurl+"?callback=?",d,function(h){var g=GeoMashup.locationCache(a.location,"attachments-"+f);if(!g.urls){g.urls=[]}jQuery.each(h,function(k,i){g.urls.push(i);GeoMashup.open_attachments.push(i);GeoMashup.map.addOverlay(i)})})})};GeoMashup.addObjectIcon=function(a){if(typeof customGeoMashupCategoryIcon==="function"&&a.terms&&a.terms.hasOwnProperty("category")){a.icon=customGeoMashupCategoryIcon(GeoMashup.opts,a.terms.category)}if(!a.icon){jQuery.each(a.terms,function(b,d){var c;if(d.length>1){a.icon=GeoMashup.clone(GeoMashup.multiple_term_icon);return false}else{if(d.length===1){c=GeoMashup.term_manager.getTermData(b,d[0],"icon");if(a.icon&&a.icon.image!==c.image){a.icon=GeoMashup.clone(GeoMashup.multiple_term_icon);return false}else{a.icon=GeoMashup.clone(c)}}}});if(!a.icon){a.icon=GeoMashup.colorIcon("red")}this.doAction("objectIcon",GeoMashup.opts,a)}};GeoMashup.createMarker=function(a,d){var b,c;if(!d.icon){this.addObjectIcon(d)}c={label:d.title,icon:d.icon.image,iconSize:d.icon.iconSize,iconShadow:d.icon.iconShadow,iconAnchor:d.icon.iconAnchor,iconShadowSize:d.icon.shadowSize,visible:true};this.doAction("objectMarkerOptions",this.opts,c,d);b=new mxn.Marker(a);b.addData(c);b.click.addHandler(function(){if(b===GeoMashup.selected_marker){GeoMashup.deselectMarker()}else{GeoMashup.selectMarker(b)}});this.doAction("marker",this.opts,b);return b};GeoMashup.clickObjectMarker=function(c,a){var b=this.objects[c];if(!GeoMashup.isObjectOn(b)){return false}if(typeof a==="undefined"){a=1}if(b&&b.marker&&a<4){if(a<2){a+=1;setTimeout(function(){GeoMashup.clickObjectMarker(c,a)},1000)}else{b.marker.click.fire()}}};GeoMashup.colorIcon=function(a){var b=this.clone(this.base_color_icon);b.image=this.opts.url_path+"/images/mm_20_"+a+".png";return b};GeoMashup.getMarkerLatLng=function(a){return a.location};GeoMashup.hideMarker=function(a){if(a===this.selected_marker){this.deselectMarker()}a.hide()};GeoMashup.showMarker=function(a){a.show()};GeoMashup.hideLine=function(a){try{a.hide()}catch(b){this.map.removePolyline(a)}a.setAttribute("visible",false)};GeoMashup.showLine=function(a){try{a.show()}catch(b){this.map.addPolyline(a)}a.setAttribute("visible",true)};GeoMashup.isLineVisible=function(a){return a.getAttribute("visible")};GeoMashup.newLatLng=function(b,a){return new mxn.LatLonPoint(b,a)};GeoMashup.extendLocationBounds=function(a){if(this.location_bounds){this.location_bounds.extend(a)}else{this.location_bounds=new mxn.BoundingBox(a,a)}};GeoMashup.addMarkers=function(a){this.forEach(a,function(c,b){this.map.addMarker(b)})};GeoMashup.makeMarkerMultiple=function(b){var c,a;if(typeof customGeoMashupMultiplePostImage==="function"){c=customGeoMashupMultiplePostImage(this.opts,b)}if(!c){c=this.opts.url_path+"/images/mm_20_plus.png"}a=b.iconUrl;b.setIcon(c);this.doAction("multiObjectMarker",this.opts,b);this.doAction("multiObjectIcon",this.opts,c);if(b.onmap&&b.iconUrl!==a){this.map.removeMarker(b);this.map.addMarker(b)}};GeoMashup.setMarkerImage=function(a,b){if(a.iconUrl!==b){a.setIcon(b);if(a.onmap){this.map.removeMarker(a);this.map.addMarker(a)}}};GeoMashup.autoZoom=function(){var a=this.map;var b=function(){var c=parseInt(GeoMashup.opts.auto_zoom_max,10);if(a.getZoom()>c){a.setZoom(c)}a.changeZoom.removeHandler(b)};if(typeof this.opts.auto_zoom_max!=="undefined"){this.map.changeZoom.addHandler(b)}this.map.autoCenterAndZoom()};GeoMashup.isMarkerVisible=function(b){var a;try{a=this.map.getBounds()}catch(c){return false}return(b.getAttribute("visible")&&a&&a.contains(b.location))};GeoMashup.centerMarker=function(a,b){if(typeof b==="number"){this.map.setCenterAndZoom(a.location,b)}else{this.map.setCenter(a.location,{},true)}};GeoMashup.createMap=function(k,m){var r,p,q,b,d,c,f,a,o,x,l,s,g,v,w=1,n={},j={};this.container=k;this.base_color_icon={};this.base_color_icon.image=m.url_path+"/images/mm_20_black.png";this.base_color_icon.iconShadow=m.url_path+"/images/mm_20_shadow.png";this.base_color_icon.iconSize=[12,20];this.base_color_icon.shadowSize=[22,20];this.base_color_icon.iconAnchor=[6,20];this.base_color_icon.infoWindowAnchor=[5,1];this.multiple_term_icon=this.clone(this.base_color_icon);this.multiple_term_icon.image=m.url_path+"/images/mm_20_mixed.png";this.forEach(m,function(e,i){if("false"===i||"FALSE"===i){m[e]=false}});this.have_parent_access=false;try{if(typeof parent==="object"){parent.document.getElementById("bogus-test");this.have_parent_access=true}}catch(u){}m.home_url=m.siteurl;d={G_NORMAL_MAP:mxn.Mapstraction.ROAD,G_SATELLITE_MAP:mxn.Mapstraction.SATELLITE,G_HYBRID_MAP:mxn.Mapstraction.HYBRID,G_PHYSICAL_MAP:mxn.Mapstraction.PHYSICAL};if(typeof m.map_type==="string"){if(d[m.map_type]){m.map_type=d[m.map_type]}else{p=parseInt(m.map_type,10);if(isNaN(p)||p>2){m.map_type=d.G_NORMAL_MAP}else{m.map_type=p}}}else{if(typeof m.map_type==="undefined"){m.map_type=d.G_NORMAL_MAP}}this.map=new mxn.Mapstraction(this.container,m.map_api);b={enableDragging:true};b.enableScrollWheelZoom=(m.enable_scroll_wheel_zoom?true:false);if(typeof this.map.enableGeoMashupExtras==="function"){this.map.enableGeoMashupExtras()}this.doAction("mapOptions",m,b);this.map.setOptions(b);this.map.setCenterAndZoom(new mxn.LatLonPoint(0,0),0);this.doAction("newMap",m,this.map);this.spinner_div=document.createElement("div");this.spinner_div.innerHTML='<div id="gm-loading-icon" style="-moz-user-select: none; z-index: 100; position: absolute; left: '+(jQuery(this.container).width()/2)+"px; top: "+(jQuery(this.container).height()/2)+'px;"><img style="border: 0px none ; margin: 0px; padding: 0px; width: 16px; height: 16px; -moz-user-select: none;" src="'+m.url_path+'/images/busy_icon.gif"/></a></div>';this.showLoadingIcon();this.map.load.addHandler(function(){GeoMashup.hideLoadingIcon()});if(!m.object_name){m.object_name="post"}this.opts=m;j.url=m.siteurl+(m.siteurl.indexOf("?")>0?"&":"?")+"geo_mashup_content=geo-query&map_name="+encodeURIComponent(m.name);if(m.lang&&j.url.indexOf("lang=")===-1){j.url+="&lang="+encodeURIComponent(m.lang)}this.doAction("geoQueryUrl",this.opts,j);this.geo_query_url=j.url;this.map.changeZoom.addHandler(function(e,i){GeoMashup.adjustZoom(e,i);GeoMashup.adjustViewport()});this.map.endPan.addHandler(function(){GeoMashup.adjustViewport()});if(m.zoom!=="auto"&&typeof m.zoom==="string"){w=parseInt(m.zoom,10)}else{w=m.zoom}if(m.load_kml){try{m.load_kml=jQuery("<div/>").html(m.load_kml).text();if(w==="auto"){this.map.addOverlay(m.load_kml,true)}else{this.map.addOverlay(m.load_kml)}}catch(t){}}if(this.term_manager){this.term_manager.load()}try{this.map.setMapType(m.map_type)}catch(h){}if(w!=="auto"){if(m.center_lat&&m.center_lng){this.map.setCenterAndZoom(new mxn.LatLonPoint(parseFloat(m.center_lat),parseFloat(m.center_lng)),w)}else{if(m.object_data&&m.object_data.objects[0]){q=new mxn.LatLonPoint(parseFloat(m.object_data.objects[0].lat),parseFloat(m.object_data.objects[0].lng));this.map.setCenterAndZoom(q,w)}else{f=this.geo_query_url+"&limit=1";if(m.map_cat){f+="&map_cat="+m.map_cat}jQuery.getJSON(f,function(e){if(e.length>0){q=new mxn.LatLonPoint(parseFloat(e[0].lat),parseFloat(e[0].lng));this.map.setCenterAndZoom(q,w)}})}}}this.location_bounds=null;if(m.map_content==="single"){if(m.object_data&&m.object_data.objects.length&&!m.load_kml){x={visible:true};if(typeof customGeoMashupSinglePostIcon==="function"){x=customGeoMashupSinglePostIcon(this.opts)}if(!x.image){x=this.colorIcon("red");x.icon=x.image}this.doAction("singleMarkerOptions",this.opts,x);s=new mxn.Marker(new mxn.LatLonPoint(parseFloat(m.object_data.objects[0].lat),parseFloat(m.object_data.objects[0].lng)));this.map.addMarkerWithData(s,x);this.doAction("singleMarker",this.opts,s)}}else{if(m.object_data){this.addObjects(m.object_data.objects,true)}else{this.requestObjects(true);this.requestObjects(false)}}if("GSmallZoomControl"===m.map_control||"GSmallZoomControl3D"===m.map_control){n.zoom="small"}else{if("GSmallMapControl"===m.map_control){n.zoom="small";n.pan=true}else{if("GLargeMapControl"===m.map_control||"GLargeMapControl3D"===m.map_control){n.zoom="large";n.pan=true}}}if(m.add_map_type_control){n.map_type=true}if(m.add_overview_control){n.overview=true}this.map.addControls(n);if(m.add_map_type_control&&typeof this.map.setMapTypes==="function"){if(typeof m.add_map_type_control==="string"){m.add_map_type_control=m.add_map_type_control.split(/\s*,\s*/);if(typeof d[m.add_map_type_control[0]]==="undefined"){m.add_map_type_control=["G_NORMAL_MAP","G_SATELLITE_MAP","G_PHYSICAL_MAP"]}}m.mxn_map_type_control=[];for(r=0;r<m.add_map_type_control.length;r+=1){m.mxn_map_type_control.push(d[m.add_map_type_control[r]])}this.map.setMapTypes(m.mxn_map_type_control)}this.map.load.addHandler(function(){GeoMashup.updateVisibleList()});if(typeof customizeGeoMashupMap==="function"){customizeGeoMashupMap(this.opts,this.map)}if(typeof customizeGeoMashup==="function"){customizeGeoMashup(this)}this.doAction("loadedMap",this.opts,this.map)};